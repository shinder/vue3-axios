<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>使用 Axios - GET</title>
    <link rel="stylesheet" href="css/list.css" />
  </head>
  <body>
    <h2>使用 Axios - GET - 取得列表資料</h2>
    <div id="pagination">
      <a href="#">1</a>
      <a href="#">2</a>
    </div>
    <div>
      <table>
        <thead>
          <tr>
            <th>編號</th>
            <th>刪除</th>
            <th>姓名</th>
            <th>Email</th>
            <th>手機</th>
            <th>生日</th>
            <th>地址</th>
            <th>編輯</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/axios-api-common.js"></script>
    <script>
      const pagination = document.querySelector("#pagination");
      const tbody = document.querySelector("tbody");
      const usp = new URLSearchParams(location.search);
      let page = +usp.get("page") || 1;
      let page_size = 20;
      (async () => {
        const response = await api.get("/address_book", {
          params: { page, page_size },
        });
        const result = response.data;
        console.log(result);
        if (!result.success) {
          alert(result.message);
          return;
        }
        const data = result.data;
        // 顯示分頁
        let str = "";
        for (let p = page - 5; p <= page + 5; p++) {
          if (p < 1 || p > result.pagination.total_pages) continue;

          const activeClass = p == page ? 'class="active"' : "";
          str += `<a href="?page=${p}" ${activeClass}>${p}</a>`;
        }
        pagination.innerHTML = str;
        // 顯示資料
        str = "";
        result.data.forEach((v, i) => {
          str += `<tr>
              <td>${v.ab_id}</td>
              <td><a href="a120-axios-delete.html?ab_id=${v.ab_id}">刪除</a></td>
              <td>${v.name}</td>
              <td>${v.email}</td>
              <td>${v.mobile}</td>
              <td>${v.birthday || ''}</td>
              <td>${v.address}</td>
              <td><a href="a110-axios-put.html?ab_id=${v.ab_id}">編輯</a></td>
            </tr>`;
        });
        tbody.innerHTML = str;
      })();
    </script>
  </body>
</html>
